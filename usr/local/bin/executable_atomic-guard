#!/bin/bash
# /usr/local/bin/atomic-guard

[[ "${ATOMIC_UPGRADE:-}" == "1" && -f "$LOCK_FILE" ]] && {
    flock -n "$LOCK_FILE" -c true 2>/dev/null && exit 1
    exit 0
}

if [[ -n "${PACMAN_HOOK_CONTEXT:-}" ]]; then
    cat << 'EOF'
════════════════════════════════════════════════════════════════
  Direct upgrade blocked. Use: sudo atomic-upgrade
════════════════════════════════════════════════════════════════
EOF
    exit 1
fi
exit 0
